import moment from "moment-timezone";

const schedule = {
  0: "🌙 {12AM} استغفر ربك قبل النوم وقل: اللهم اجعل لي من أمري فرجًا.",
  1: "🕐 {1AM} دعاء جميل: حسبي الله لا إله إلا هو عليه توكلت وهو رب العرش العظيم.",
  2: "🕑 {2AM} لا تنس قيام الليل، ولو بركعتين وصلاة الوتر 💫",
  3: "🕒 {3AM} الثلث الأخير من الليل، استغفر وادعُ فإن الدعاء مستجاب 🌙",
  4: "🕓 {4AM} اقترب الفجر، توضأ واستعد لوقوفك بين يدي الله 🌄",
  5: "🌅 {5AM} أذكار الصباح 🌞: قل 'أصبحنا وأصبح الملك لله'",
  6: "🕕 {6AM} ردد: اللهم إني أسألك خير هذا اليوم، فتحه ونصره 🌼",
  7: "🕖 {7AM} لا تنسَ نية صالحة لهذا اليوم، فـالأعمال بالنيات ✨",
  8: "🕗 {8AM} ردد: سبحان الله وبحمده، سبحان الله العظيم 💬",
  9: "🕘 {9AM} تذكير: صلِ على النبي ﷺ، تفتح لك الأبواب ❤️",
  10: "🕙 {10AM} قل: لا حول ولا قوة إلا بالله، كنز من كنوز الجنة",
  11: "🕚 {11AM} أكثر من قول: أستغفر الله العظيم 🌿",
  12: "🕛 {12PM} تجهّز لصلاة الظهر، فالصلاة عماد الدين 🕌",
  13: "🕐 {1PM} قل: يا حي يا قيوم برحمتك أستغيث 🙏",
  14: "🕑 {2PM} اجعل هذا الوقت ذكرًا واستغفارًا 💭",
  15: "🕒 {3PM} تذكير بصلاة العصر، لا تؤخرها 🌇",
  16: "🕓 {4PM} ردد: اللهم اجعلني من التوابين 💧",
  17: "🕔 {5PM} وقت أذكار المساء، لا تنسَ تحصين نفسك 💠",
  18: "🌆 {6PM} قل: أعوذ بكلمات الله التامات من شر ما خلق 🕯️",
  19: "🕖 {7PM} ادعُ: اللهم اجعل هذا المساء هدوءًا لقلوبنا 🌙",
  20: "🕗 {8PM} لو اليوم جمعة، اقرأ سورة الكهف 🕌",
  21: "🕘 {9PM} استعد للنوم: سبحان الله 33، الحمد لله 33، الله أكبر 34",
  22: "🌙 {10PM} لحظة هدوء: قل 'اللهم آتنا في الدنيا حسنة' 🤲",
  23: "🕚 {11PM} اغلق يومك بدعاء: اللهم إني فوضت أمري إليك ✨"
};

let lastSentHour = -1;

function onLoad() {
  setInterval(() => {
    const hour = moment().tz("Asia/Riyadh").hour(); // 🕒 توقيت السعودية

    if (hour === lastSentHour) return;
    lastSentHour = hour;

    const message = schedule[hour];
    if (!message) return;

    const threads = global.data.threads || new Map();
    for (const [threadID, thread] of threads.entries()) {
      if (thread?.data?.dailyNoti === false) continue;
      global.api.sendMessage(message, threadID);
    }

  }, 1000 * 60); // كل دقيقة نتحقق من الساعة
}

export default {
  onLoad
};
